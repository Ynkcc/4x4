# 4x4暗棋 AI 对弈系统使用说明

## 文件说明

### GUI版本（推荐）
1. **launcher.py** - 图形界面启动器
2. **gui_game.py** - 图形界面人机对弈
3. **gui_ai_vs_ai.py** - 图形界面AI对弈观察

### 控制台版本
4. **play_with_human.py** - 控制台人机对弈脚本
5. **quick_play.py** - 快速启动控制台人机对弈
6. **ai_vs_ai.py** - 控制台AI vs AI 对弈观察脚本

### 核心文件
7. **train.py** - 训练脚本（已存在）
8. **Game.py** - 游戏环境（已存在）

## 使用方法

### 🎮 GUI版本（推荐使用）

#### 启动器方式
```bash
python launcher.py
```
通过图形界面选择不同的游戏模式。

#### 直接启动GUI
```bash
# 人机对弈GUI
python gui_game.py

# AI对弈观察GUI
python gui_ai_vs_ai.py
```

**GUI版本功能：**
- 直观的图形界面，点击操作
- 实时棋盘显示，彩色棋子
- 智能动作选择菜单
- 游戏日志和统计信息
- 可调节的AI思考延迟
- 多局连续对弈支持

### 📟 控制台版本

#### 1. 人机对弈

**方法一：使用详细版本**
```bash
python play_with_human.py
```

**方法二：使用快速启动**
```bash
python quick_play.py
```

**功能：**
- 选择AI模型（最佳模型、最终模型或检查点模型）
- 选择扮演红方或黑方
- 显示合法动作列表
- 实时显示棋盘状态
- 彩色输出，便于区分

#### 2. AI对弈观察

```bash
python ai_vs_ai.py
```

**功能：**
- 选择两个不同的AI模型对弈
- 单局对弈：显示详细过程
- 多局对弈：统计胜率和平均数据
- 观察AI的策略和水平

### 3. 训练新模型

```bash
python train.py
```

**说明：**
- 这会启动自我对弈训练过程
- 模型会保存在 `./banqi_ppo_logs/` 目录下
- 包含定期检查点和最佳模型

## 依赖环境

### 基本依赖
```bash
pip install stable-baselines3[extra]
pip install sb3-contrib
pip install gymnasium
```

### GUI版本额外依赖
```bash
pip install PySide6
```

## GUI版本操作说明

### 人机对弈GUI
1. 启动后选择AI模型和您的一方
2. 点击"开始游戏"开始对弈
3. 点击棋盘上的棋子进行操作
4. 如果一个位置有多个可用动作，会弹出选择菜单
5. 游戏过程和结果会显示在右侧面板

### AI对弈观察GUI
1. 分别选择红方和黑方的AI模型
2. 设置对弈局数和观察延迟
3. 可选择自动连续对弈模式
4. 点击"开始对弈"观察AI对弈过程
5. 实时统计显示胜率和平均数据

## 游戏规则

### 基本规则
- 4x4棋盘，每方7种棋子各1-2个
- 棋子类型：兵(A)、炮(B)、马(C)、车(D)、象(E)、士(F)、将(G)
- 初始时所有棋子都是暗棋

### 动作类型
1. **翻棋**：翻开一个暗棋
2. **移动**：将明棋移动到相邻空格
3. **攻击**：攻击相邻的对方明棋

### 胜负判定
- 率先达到60分获胜
- 连续40步无吃子/翻棋则平局
- 无合法动作则败北

### 分值系统
- 兵(A): 4分
- 炮(B): 10分
- 马(C): 10分
- 车(D): 10分
- 象(E): 10分
- 士(F): 20分
- 将(G): 30分

## 操作提示

### 人机对弈时的输入
- 系统会显示所有合法动作
- 输入数字选择动作（如输入"1"选择第1个动作）
- 支持Ctrl+C中断游戏

### 动作格式说明
- GUI版本：直接点击棋盘操作，如有多个动作会弹出选择菜单
- 控制台版本：
  - "翻开 (row,col)" - 翻开指定位置的暗棋
  - "从 (row,col) 向上移动/攻击" - 向上方移动或攻击
  - 坐标从(0,0)开始，(0,0)在左上角

## 模型选择建议

1. **best_model.zip** - 训练过程中表现最佳的模型
2. **banqi_ppo_model.zip** - 最终训练完成的模型
3. **rl_model_XXXXX_steps.zip** - 不同训练步数的检查点模型

建议优先使用best_model.zip来测试AI水平。

## 故障排除

### 1. 模型加载失败
- 确保已经运行过训练脚本
- 检查 `./banqi_ppo_logs/` 目录是否存在模型文件

### 2. 依赖包问题
```bash
# 基本依赖
pip install stable-baselines3[extra]
pip install sb3-contrib
pip install gymnasium

# GUI版本额外依赖
pip install PySide6
```

### 3. GUI版本问题
- 如果GUI界面显示异常，请更新PySide6到最新版本
- 在某些Linux系统上可能需要安装额外的Qt依赖

### 4. 显示问题
- 终端支持彩色输出效果更佳（控制台版本）
- 建议使用支持Unicode的终端（控制台版本）
- GUI版本对终端无特殊要求

## 测试AI水平的方法

### GUI版本（推荐）
1. **直接对弈**：使用gui_game.py与AI下棋，界面友好
2. **观察AI vs AI**：使用gui_ai_vs_ai.py观察不同模型对弈
3. **批量测试**：在AI vs AI界面进行多局对弈统计
4. **模型对比**：选择不同训练步数的模型进行对比

### 控制台版本
1. **直接对弈**：与AI下棋，感受其策略
2. **观察AI vs AI**：让不同模型对弈，比较强弱
3. **多局统计**：运行多局对弈，查看胜率统计
4. **不同阶段模型对比**：使用不同训练步数的模型对弈

### 推荐测试流程
1. 使用launcher.py启动GUI界面
2. 先进行几局人机对弈感受AI水平
3. 使用AI vs AI模式观察不同模型的强弱
4. 进行多局统计分析AI的稳定性

祝您游戏愉快！
